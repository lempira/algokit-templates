{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "AlgoKit Configuration Schema",
  "description": "JSON Schema for .algokit.toml configuration files used by AlgoKit CLI",
  "type": "object",
  "properties": {
    "algokit": {
      "type": "object",
      "description": "AlgoKit CLI-specific configuration",
      "properties": {
        "min_version": {
          "type": "string",
          "description": "Minimum required version of AlgoKit CLI",
          "pattern": "^v?\\d+\\.\\d+\\.\\d+(?:-[a-zA-Z0-9.-]+)?$",
          "examples": ["v2.0.0", "1.3.1", "v1.1.0-beta.4"]
        }
      },
      "additionalProperties": false
    },
    "project": {
      "type": "object",
      "description": "Project configuration and metadata",
      "properties": {
        "type": {
          "type": "string",
          "description": "Type of AlgoKit project",
          "enum": ["contracts", "frontend", "fullstack"]
        },
        "name": {
          "type": "string",
          "description": "Name of the project",
          "minLength": 1
        },
        "projects_root_path": {
          "type": "string",
          "description": "Root path for sub-projects in a workspace",
          "minLength": 1
        },
        "artifacts": {
          "type": "string",
          "description": "Path to artifacts directory for contract projects",
          "minLength": 1
        },
        "generators": {
          "type": "object",
          "description": "Track applied generators with metadata",
          "patternProperties": {
            "^[a-zA-Z0-9_-]+$": {
              "$ref": "#/$defs/generatorMetadata"
            }
          },
          "additionalProperties": false
        },
        "deploy": {
          "$ref": "#/$defs/deployConfig"
        },
        "run": {
          "oneOf": [
            {
              "$ref": "#/$defs/workspaceRunConfig"
            },
            {
              "$ref": "#/$defs/standaloneRunConfig"
            }
          ]
        }
      },
      "allOf": [
        {
          "if": {
            "properties": {
              "generators": {
                "properties": {
                  "workspace": {
                    "type": "object"
                  }
                },
                "required": ["workspace"]
              }
            }
          },
          "then": {
            "required": ["projects_root_path"]
          }
        }
      ],
      "required": ["type", "name"],
      "additionalProperties": false
    },
    "deploy": {
      "$ref": "#/$defs/deployConfig",
      "description": "Legacy deploy configuration (deprecated, use project.deploy instead)"
    }
  },
  "additionalProperties": false,
  "$defs": {
    "generatorMetadata": {
      "type": "object",
      "description": "Metadata for an applied generator",
      "properties": {
        "version": {
          "type": "string",
          "description": "Version of the generator that was applied",
          "pattern": "^\\d+\\.\\d+\\.\\d+$"
        },
        "timestamp": {
          "type": "string",
          "description": "ISO 8601 timestamp when generator was applied",
          "format": "date-time"
        },
        "source": {
          "type": "string",
          "description": "Source of the generator (e.g., 'official', URL)",
          "default": "official"
        },
        "detected_type": {
          "type": "string",
          "description": "Auto-detected project type for context-aware generators"
        }
      },
      "required": ["version", "timestamp"],
      "additionalProperties": true
    },
    "deployConfig": {
      "type": "object",
      "description": "Deployment configuration",
      "properties": {
        "command": {
          "oneOf": [
            {
              "type": "string",
              "description": "Deploy command as a string",
              "minLength": 1
            },
            {
              "type": "array",
              "description": "Deploy command as an array of strings",
              "items": {
                "type": "string"
              },
              "minItems": 1
            }
          ]
        },
        "environment_secrets": {
          "type": "array",
          "description": "List of environment variable names to treat as secrets",
          "items": {
            "type": "string",
            "minLength": 1
          },
          "uniqueItems": true
        }
      },
      "patternProperties": {
        "^[a-zA-Z0-9_-]+$": {
          "type": "object",
          "description": "Network-specific deployment configuration",
          "properties": {
            "command": {
              "oneOf": [
                {
                  "type": "string",
                  "description": "Deploy command as a string for this network",
                  "minLength": 1
                },
                {
                  "type": "array",
                  "description": "Deploy command as an array of strings for this network",
                  "items": {
                    "type": "string"
                  },
                  "minItems": 1
                }
              ]
            },
            "environment_secrets": {
              "type": "array",
              "description": "List of environment variable names to treat as secrets for this network",
              "items": {
                "type": "string",
                "minLength": 1
              },
              "uniqueItems": true
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "workspaceRunConfig": {
      "type": "object",
      "description": "Workspace run configuration defining execution order",
      "patternProperties": {
        "^[a-zA-Z0-9_-]+$": {
          "type": "array",
          "description": "Ordered list of project names for command execution",
          "items": {
            "type": "string",
            "minLength": 1
          },
          "uniqueItems": true
        }
      },
      "additionalProperties": false
    },
    "standaloneRunConfig": {
      "type": "object",
      "description": "Standalone project run configuration",
      "patternProperties": {
        "^[a-zA-Z0-9_-]+$": {
          "$ref": "#/$defs/customCommand"
        }
      },
      "additionalProperties": false
    },
    "customCommand": {
      "type": "object",
      "description": "Custom command configuration",
      "properties": {
        "commands": {
          "type": "array",
          "description": "List of commands to execute",
          "items": {
            "type": "string",
            "minLength": 1
          },
          "minItems": 1
        },
        "description": {
          "type": "string",
          "description": "Description of what the command does",
          "minLength": 1
        },
        "env_file": {
          "type": "string",
          "description": "Path to environment file to load",
          "minLength": 1
        }
      },
      "required": ["commands"],
      "additionalProperties": false
    }
  }
}